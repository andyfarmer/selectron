// --------------------------------------------------------------------------
//            _           _                   
//   ___  ___| | ___  ___| |_ _ __ ___  _ __  
//  / __|/ _ \ |/ _ \/ __| __| '__/ _ \| '_ \ 
//  \__ \  __/ |  __/ (__| |_| | | (_) | | | |
//  |___/\___|_|\___|\___|\__|_|  \___/|_| |_|
//
// --------------------------------------------------------------------------
//  Version: 1.0
//   Author: Simon Sturgess
//  Website: dahliacreative.github.io/selectron
//     Docs: dahliacreative.github.io/selectron/docs
//     Repo: github.com/dahliacreative/selectron
//   Issues: github.com/dahliacreative/selectron/issues
// --------------------------------------------------------------------------
!function(e){e.fn.selectron=function(){if("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)var o=!0;return this.each(function(){populateOptions=function(){o||(r.find("option").each(function(){var o=e(this),t=o.val(),s=o.text(),i=o.prop("disabled"),l=o.prop("selected"),r=e('<li class="selectron__option" data-value="'+t+'">'+s+"</li>");r.toggleClass("selectron__option--is-disabled",i),r.toggleClass("selectron__option--is-selected",l),r.on("click",function(){updateSelection(e(this))}),r.on("mouseenter",function(){updateHover(e(this))}),n.append(r)}),n.find(".selectron__option:first").addClass("selectron__option--is-hovered"),updateTrigger())},updateHover=function(e){e.addClass("selectron__option--is-hovered").siblings().removeClass("selectron__option--is-hovered")},toggleOptions=function(e){e.stopPropagation(),o||n.toggleClass("selectron__options--is-open"),c=s.toggleClass("selectron__trigger--is-open").hasClass("selectron__trigger--is-open")},openOptions=function(){n.addClass("selectron__options--is-open"),s.addClass("selectron__trigger--is-open"),c=!0},closeOptions=function(){n.removeClass("selectron__options--is-open"),s.removeClass("selectron__trigger--is-open"),c=!1},updateSelection=function(e){console.log(e);var o=e.data("value");e.addClass("selectron__option--is-selected").siblings().removeClass("selectron__option--is-selected"),updateTrigger(),r.val(o).trigger("selectron.change")},updateValue=function(e){n.find('[data-value="'+e+'"]').addClass("selectron__option--is-selected").siblings().removeClass("selectron__option--is-selected"),updateTrigger()},updateTrigger=function(){var e=n.find(".selectron__option--is-selected"),o=e.text(),t=e.data("value"),i=""===t?!0:!1;s.html(o),s.toggleClass("selectron__trigger--is-filled",!i)},handleKeyStrokes=function(e){var o=n.find(".selectron__option--is-hovered");if(!c&&32!=e.which)return!1;if(32===e.which&&(c?closeOptions():openOptions()),13===e.which&&(closeOptions(),updateSelection(o)),38===e.which||40===e.which){var t;40===e.which?t=o.is(":last-child")?n.find(".selectron__option:first-child"):o.next():38===e.which&&(t=o.is(":first-child")?n.find(".selectron__option:last-child"):o.prev()),updateHover(t)}if(e.which>=48&&e.which<=57||e.which>=65&&e.which<=90||8===e.which){clearTimeout(l),l=setTimeout(clearSearchTerm,500),a+=String.fromCharCode(e.which).toLowerCase(),optCount=n.find("li").length+1,console.log(a);for(var s=1;s<optCount;s++){var i=n.find("li:nth-child("+s+")"),r=i.text().toLowerCase();if(r.indexOf(a)>=0)return void i.addClass("selectron__option--is-hovered").siblings().removeClass("selectron__option--is-hovered")}}},clearSearchTerm=function(){a=""};var t,s,n,i,l,r=e(this),a="",c=!1;return r.hasClass("selectron__select")||"SELECT"!==r[0].tagName?void 0:(i=r.prop("disabled"),t=e('<div class="selectron"/>'),s=e('<button class="selectron__trigger">'),n=e('<ul class="selectron__options"/>'),r.removeClass("selectron").addClass("selectron__select"),r.hasClass("selectron--dark")&&(r.removeClass("selectron--dark"),t.addClass("selectron--dark")),r.replaceWith(t),t.append(r,s,n),t.toggleClass("selectron__disabled",i),s.on("click",toggleOptions),e(document).on("click",closeOptions),s.on("keyup",handleKeyStrokes),s.on("keydown",function(e){e.preventDefault()}),r.on("selectron.update",function(){return n.empty(),populateOptions()}),r.on("change",function(){var o=e(this).val();updateValue(o)}),populateOptions())})}}(jQuery);